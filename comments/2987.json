[
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/145603639",
    "html_url": "https://github.com/electron/electron/issues/2987#issuecomment-145603639",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/2987",
    "id": 145603639,
    "user": {
      "login": "etiktin",
      "id": 4381579,
      "avatar_url": "https://avatars1.githubusercontent.com/u/4381579?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/etiktin",
      "html_url": "https://github.com/etiktin",
      "followers_url": "https://api.github.com/users/etiktin/followers",
      "following_url": "https://api.github.com/users/etiktin/following{/other_user}",
      "gists_url": "https://api.github.com/users/etiktin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/etiktin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/etiktin/subscriptions",
      "organizations_url": "https://api.github.com/users/etiktin/orgs",
      "repos_url": "https://api.github.com/users/etiktin/repos",
      "events_url": "https://api.github.com/users/etiktin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/etiktin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-05T17:20:11Z",
    "updated_at": "2015-10-05T23:16:05Z",
    "body": "This also happens on Windows using the v0.33.6.\n\nIt seems that `browser_context_->prefs()->SetFilePath(prefs::kDownloadDefaultDirectory, path)` doesn't do anything. If you try to call get on the same value directly after (e.g. `browser_context_->prefs()->GetFilePath(prefs::kDownloadDefaultDirectory)`), you get an empty string even though `path` is not empty.\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/145695767",
    "html_url": "https://github.com/electron/electron/issues/2987#issuecomment-145695767",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/2987",
    "id": 145695767,
    "user": {
      "login": "etiktin",
      "id": 4381579,
      "avatar_url": "https://avatars1.githubusercontent.com/u/4381579?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/etiktin",
      "html_url": "https://github.com/etiktin",
      "followers_url": "https://api.github.com/users/etiktin/followers",
      "following_url": "https://api.github.com/users/etiktin/following{/other_user}",
      "gists_url": "https://api.github.com/users/etiktin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/etiktin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/etiktin/subscriptions",
      "organizations_url": "https://api.github.com/users/etiktin/orgs",
      "repos_url": "https://api.github.com/users/etiktin/repos",
      "events_url": "https://api.github.com/users/etiktin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/etiktin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-05T23:15:47Z",
    "updated_at": "2015-10-05T23:15:47Z",
    "body": "The issue is that `AtomBrowserContext::RegisterPrefs` is never called, so the download directory is never registered in the pref service which means that changes to it are ignored.\n\nIf I hard code the preferences in BrowserContext (the parent class), then it works. For example:\n\n``` javascript\nvoid BrowserContext::RegisterInternalPrefs(PrefRegistrySimple* registry) {\n  InspectableWebContentsImpl::RegisterPrefs(registry);\n\n  // This works\n  registry->RegisterFilePathPref(\"download.default_directory\",\n                                      base::FilePath());\n  registry->RegisterFilePathPref(\"selectfile.last_directory\",\n                                      base::FilePath());\n}\n```\n\nThis is a bit weird, since session is supposed to work with AtomBrowserContext which is a subclass of BrowserContext, but only the parent function (`BrowserContext::RegisterPrefs`) is called.\n\n@zcbenz, @hokein what do you think might cause this?\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/145721917",
    "html_url": "https://github.com/electron/electron/issues/2987#issuecomment-145721917",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/2987",
    "id": 145721917,
    "user": {
      "login": "hokein",
      "id": 2557445,
      "avatar_url": "https://avatars2.githubusercontent.com/u/2557445?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hokein",
      "html_url": "https://github.com/hokein",
      "followers_url": "https://api.github.com/users/hokein/followers",
      "following_url": "https://api.github.com/users/hokein/following{/other_user}",
      "gists_url": "https://api.github.com/users/hokein/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hokein/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hokein/subscriptions",
      "organizations_url": "https://api.github.com/users/hokein/orgs",
      "repos_url": "https://api.github.com/users/hokein/repos",
      "events_url": "https://api.github.com/users/hokein/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hokein/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-06T02:01:26Z",
    "updated_at": "2015-10-06T02:01:26Z",
    "body": "I believe this is a regression issue, it works on v0.30.X and v0.31.X(#2855).\n\n@etiktin Thanks for the detailed investigation on it!\nThe result is a little surprising. After a closer look, it is caused by calling a virtual function in a class's constructor. In a constructor, the virtual call mechanism is disabled because the derived class is created only after the parent class is constructed. \n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/145879730",
    "html_url": "https://github.com/electron/electron/issues/2987#issuecomment-145879730",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/2987",
    "id": 145879730,
    "user": {
      "login": "zcbenz",
      "id": 639601,
      "avatar_url": "https://avatars3.githubusercontent.com/u/639601?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zcbenz",
      "html_url": "https://github.com/zcbenz",
      "followers_url": "https://api.github.com/users/zcbenz/followers",
      "following_url": "https://api.github.com/users/zcbenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/zcbenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zcbenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zcbenz/subscriptions",
      "organizations_url": "https://api.github.com/users/zcbenz/orgs",
      "repos_url": "https://api.github.com/users/zcbenz/repos",
      "events_url": "https://api.github.com/users/zcbenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zcbenz/received_events",
      "type": "User",
      "site_admin": true
    },
    "created_at": "2015-10-06T14:45:34Z",
    "updated_at": "2015-10-06T14:45:34Z",
    "body": "Fixed by https://github.com/atom/brightray/pull/152.\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/145887481",
    "html_url": "https://github.com/electron/electron/issues/2987#issuecomment-145887481",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/2987",
    "id": 145887481,
    "user": {
      "login": "etiktin",
      "id": 4381579,
      "avatar_url": "https://avatars1.githubusercontent.com/u/4381579?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/etiktin",
      "html_url": "https://github.com/etiktin",
      "followers_url": "https://api.github.com/users/etiktin/followers",
      "following_url": "https://api.github.com/users/etiktin/following{/other_user}",
      "gists_url": "https://api.github.com/users/etiktin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/etiktin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/etiktin/subscriptions",
      "organizations_url": "https://api.github.com/users/etiktin/orgs",
      "repos_url": "https://api.github.com/users/etiktin/repos",
      "events_url": "https://api.github.com/users/etiktin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/etiktin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-06T15:06:39Z",
    "updated_at": "2015-10-06T15:06:39Z",
    "body": "@hokein, thanks for the explanation :beers: \n"
  }
]