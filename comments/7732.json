[
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/256105655",
    "html_url": "https://github.com/electron/electron/issues/7732#issuecomment-256105655",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/7732",
    "id": 256105655,
    "user": {
      "login": "iglosiggio",
      "id": 1154680,
      "avatar_url": "https://avatars0.githubusercontent.com/u/1154680?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iglosiggio",
      "html_url": "https://github.com/iglosiggio",
      "followers_url": "https://api.github.com/users/iglosiggio/followers",
      "following_url": "https://api.github.com/users/iglosiggio/following{/other_user}",
      "gists_url": "https://api.github.com/users/iglosiggio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iglosiggio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iglosiggio/subscriptions",
      "organizations_url": "https://api.github.com/users/iglosiggio/orgs",
      "repos_url": "https://api.github.com/users/iglosiggio/repos",
      "events_url": "https://api.github.com/users/iglosiggio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iglosiggio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-10-25T17:37:25Z",
    "updated_at": "2016-10-25T17:37:25Z",
    "body": "Well, the module used new and passed the buffer to v8 marking it as internalized. It seems that the new allocator in Renderer and Main contexts are different and that caused the double free.\n\nI don't know if this needs to be in any wiki about how to develop native modules but i didn't found it (and got lucky resolving it via trial & error).\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/256178719",
    "html_url": "https://github.com/electron/electron/issues/7732#issuecomment-256178719",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/7732",
    "id": 256178719,
    "user": {
      "login": "zeke",
      "id": 2289,
      "avatar_url": "https://avatars2.githubusercontent.com/u/2289?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zeke",
      "html_url": "https://github.com/zeke",
      "followers_url": "https://api.github.com/users/zeke/followers",
      "following_url": "https://api.github.com/users/zeke/following{/other_user}",
      "gists_url": "https://api.github.com/users/zeke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zeke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zeke/subscriptions",
      "organizations_url": "https://api.github.com/users/zeke/orgs",
      "repos_url": "https://api.github.com/users/zeke/repos",
      "events_url": "https://api.github.com/users/zeke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zeke/received_events",
      "type": "User",
      "site_admin": true
    },
    "created_at": "2016-10-25T21:17:30Z",
    "updated_at": "2016-10-25T21:17:30Z",
    "body": "What solved the problem for you, @iglosiggio?\n\nIf there are some good take-aways, please consider opening a PR with updates to https://github.com/electron/electron/blob/master/docs/tutorial/using-native-node-modules.md\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/256198405",
    "html_url": "https://github.com/electron/electron/issues/7732#issuecomment-256198405",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/7732",
    "id": 256198405,
    "user": {
      "login": "iglosiggio",
      "id": 1154680,
      "avatar_url": "https://avatars0.githubusercontent.com/u/1154680?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iglosiggio",
      "html_url": "https://github.com/iglosiggio",
      "followers_url": "https://api.github.com/users/iglosiggio/followers",
      "following_url": "https://api.github.com/users/iglosiggio/following{/other_user}",
      "gists_url": "https://api.github.com/users/iglosiggio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iglosiggio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iglosiggio/subscriptions",
      "organizations_url": "https://api.github.com/users/iglosiggio/orgs",
      "repos_url": "https://api.github.com/users/iglosiggio/repos",
      "events_url": "https://api.github.com/users/iglosiggio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iglosiggio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-10-25T22:37:35Z",
    "updated_at": "2016-10-25T22:37:35Z",
    "body": "The `new` operator has different allocators in main and renderer contexts. The module allocated memory with `new` and passed it to v8 with the 'internalized' flag.\n\nThe v8 GC conflicted with the blink page allocator (i'm still not sure on how) and that caused the bug (which i think it's a double free).\n\nThe solution was to have all that memory managed by v8, but it may be possible that lots of native modules have similar code.\n\nIn cases where it's not feasible to change the module it can be proxied via ipc.\n\nI don't know if this is normal enough to modify the manual üòù\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/256229942",
    "html_url": "https://github.com/electron/electron/issues/7732#issuecomment-256229942",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/7732",
    "id": 256229942,
    "user": {
      "login": "zcbenz",
      "id": 639601,
      "avatar_url": "https://avatars3.githubusercontent.com/u/639601?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zcbenz",
      "html_url": "https://github.com/zcbenz",
      "followers_url": "https://api.github.com/users/zcbenz/followers",
      "following_url": "https://api.github.com/users/zcbenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/zcbenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zcbenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zcbenz/subscriptions",
      "organizations_url": "https://api.github.com/users/zcbenz/orgs",
      "repos_url": "https://api.github.com/users/zcbenz/repos",
      "events_url": "https://api.github.com/users/zcbenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zcbenz/received_events",
      "type": "User",
      "site_admin": true
    },
    "created_at": "2016-10-26T02:02:33Z",
    "updated_at": "2016-10-26T02:02:33Z",
    "body": "In renderer process the `ArrayBuffer` is managed by blink so you should never use raw `v8::ArrayBuffer` API in native modules, you can find more details at: https://github.com/electron/electron/issues/2601#issuecomment-135258750.\n\nTo solve this you have to change the modules to use `node::Buffer` APIs, it is hard work though.\n\nClosing since it is something we are unable to fix.\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/256237102",
    "html_url": "https://github.com/electron/electron/issues/7732#issuecomment-256237102",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/7732",
    "id": 256237102,
    "user": {
      "login": "iglosiggio",
      "id": 1154680,
      "avatar_url": "https://avatars0.githubusercontent.com/u/1154680?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iglosiggio",
      "html_url": "https://github.com/iglosiggio",
      "followers_url": "https://api.github.com/users/iglosiggio/followers",
      "following_url": "https://api.github.com/users/iglosiggio/following{/other_user}",
      "gists_url": "https://api.github.com/users/iglosiggio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iglosiggio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iglosiggio/subscriptions",
      "organizations_url": "https://api.github.com/users/iglosiggio/orgs",
      "repos_url": "https://api.github.com/users/iglosiggio/repos",
      "events_url": "https://api.github.com/users/iglosiggio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iglosiggio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-10-26T02:59:06Z",
    "updated_at": "2016-10-26T02:59:06Z",
    "body": "Thanks for the comment, now it's working well (but it's a v8::ArrayBuffer) the problem was resolved making v8 allocate the memory instead of allocating it with a `new uint8_t[size]` and passing it to v8.\n"
  }
]