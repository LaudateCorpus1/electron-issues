[
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/145386759",
    "html_url": "https://github.com/electron/electron/issues/2984#issuecomment-145386759",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/2984",
    "id": 145386759,
    "user": {
      "login": "felicienfrancois",
      "id": 988144,
      "avatar_url": "https://avatars1.githubusercontent.com/u/988144?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/felicienfrancois",
      "html_url": "https://github.com/felicienfrancois",
      "followers_url": "https://api.github.com/users/felicienfrancois/followers",
      "following_url": "https://api.github.com/users/felicienfrancois/following{/other_user}",
      "gists_url": "https://api.github.com/users/felicienfrancois/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/felicienfrancois/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/felicienfrancois/subscriptions",
      "organizations_url": "https://api.github.com/users/felicienfrancois/orgs",
      "repos_url": "https://api.github.com/users/felicienfrancois/repos",
      "events_url": "https://api.github.com/users/felicienfrancois/events{/privacy}",
      "received_events_url": "https://api.github.com/users/felicienfrancois/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-04T20:52:57Z",
    "updated_at": "2015-10-04T20:52:57Z",
    "body": "https://developer.mozilla.org/en/docs/Web/API/Window/setImmediate\n\n> Note: This method is not expected to become standard, and is only implemented by recent builds of Internet Explorer and Node.js 0.10+. It meets resistance both from Gecko (Firefox) and Webkit (Google/Apple).\n\nsetImmediate is not implemented in Chromium/Chrome and may never be implemented. For now, the only solution is to use `setTimeout`\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/145388084",
    "html_url": "https://github.com/electron/electron/issues/2984#issuecomment-145388084",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/2984",
    "id": 145388084,
    "user": {
      "login": "etiktin",
      "id": 4381579,
      "avatar_url": "https://avatars1.githubusercontent.com/u/4381579?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/etiktin",
      "html_url": "https://github.com/etiktin",
      "followers_url": "https://api.github.com/users/etiktin/followers",
      "following_url": "https://api.github.com/users/etiktin/following{/other_user}",
      "gists_url": "https://api.github.com/users/etiktin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/etiktin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/etiktin/subscriptions",
      "organizations_url": "https://api.github.com/users/etiktin/orgs",
      "repos_url": "https://api.github.com/users/etiktin/repos",
      "events_url": "https://api.github.com/users/etiktin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/etiktin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-04T21:14:34Z",
    "updated_at": "2015-10-04T21:14:34Z",
    "body": "As a workaround, you might be able to use the [setImmediate.js](https://github.com/YuzuJS/setImmediate) polyfill at the start of your preload script.\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/145390368",
    "html_url": "https://github.com/electron/electron/issues/2984#issuecomment-145390368",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/2984",
    "id": 145390368,
    "user": {
      "login": "antoinepairet",
      "id": 5238592,
      "avatar_url": "https://avatars0.githubusercontent.com/u/5238592?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/antoinepairet",
      "html_url": "https://github.com/antoinepairet",
      "followers_url": "https://api.github.com/users/antoinepairet/followers",
      "following_url": "https://api.github.com/users/antoinepairet/following{/other_user}",
      "gists_url": "https://api.github.com/users/antoinepairet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/antoinepairet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/antoinepairet/subscriptions",
      "organizations_url": "https://api.github.com/users/antoinepairet/orgs",
      "repos_url": "https://api.github.com/users/antoinepairet/repos",
      "events_url": "https://api.github.com/users/antoinepairet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/antoinepairet/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-04T21:36:44Z",
    "updated_at": "2015-10-04T21:36:44Z",
    "body": "@felicienfrancois Thanks for your reply. It's not about having `setImmediate` defined in Chrome/Chromium. Let me try to explain it again.\nAs far as I understand it, having `node-integration = false` should not affect the preloaded script (we can still use `require`, `process` is defined etc.). However, making HTTPS calls in the preloaded script with `setImmediate` undefined will throw errors due to `_tls_wrap.js` relying on `setImmediate`.\nI do not understand why `setImmediate` should be undefined while `process` etc. are OK.\n\n@etiktin Thanks for the hint. Sadly, `require('setimmediate');` at the beginning of my preload script does not fix the issue. [It returns directly](https://github.com/YuzuJS/setImmediate/blob/master/setImmediate.js#L5)\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/145392142",
    "html_url": "https://github.com/electron/electron/issues/2984#issuecomment-145392142",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/2984",
    "id": 145392142,
    "user": {
      "login": "etiktin",
      "id": 4381579,
      "avatar_url": "https://avatars1.githubusercontent.com/u/4381579?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/etiktin",
      "html_url": "https://github.com/etiktin",
      "followers_url": "https://api.github.com/users/etiktin/followers",
      "following_url": "https://api.github.com/users/etiktin/following{/other_user}",
      "gists_url": "https://api.github.com/users/etiktin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/etiktin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/etiktin/subscriptions",
      "organizations_url": "https://api.github.com/users/etiktin/orgs",
      "repos_url": "https://api.github.com/users/etiktin/repos",
      "events_url": "https://api.github.com/users/etiktin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/etiktin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-04T22:04:36Z",
    "updated_at": "2015-10-04T22:04:36Z",
    "body": "If it returns it means that `global.setImmediate` is defined, but you said in the OP that it's `undefined` in the preload script.\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/145395203",
    "html_url": "https://github.com/electron/electron/issues/2984#issuecomment-145395203",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/2984",
    "id": 145395203,
    "user": {
      "login": "antoinepairet",
      "id": 5238592,
      "avatar_url": "https://avatars0.githubusercontent.com/u/5238592?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/antoinepairet",
      "html_url": "https://github.com/antoinepairet",
      "followers_url": "https://api.github.com/users/antoinepairet/followers",
      "following_url": "https://api.github.com/users/antoinepairet/following{/other_user}",
      "gists_url": "https://api.github.com/users/antoinepairet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/antoinepairet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/antoinepairet/subscriptions",
      "organizations_url": "https://api.github.com/users/antoinepairet/orgs",
      "repos_url": "https://api.github.com/users/antoinepairet/repos",
      "events_url": "https://api.github.com/users/antoinepairet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/antoinepairet/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-04T22:39:38Z",
    "updated_at": "2015-10-04T22:39:38Z",
    "body": "@etiktin See this minimum example:\n\nMain script:\n\n``` js\nmainWindow = new BrowserWindow({\n    'web-preferences': {\n        'node-integration': false,\n        preload: path.join(__dirname, './preload.js')\n    }\n});\n```\n\npreload.js:\n\n``` js\nvar request = require('request');\nvar fs = require('fs');\n\nconsole.log(typeof setImmediate); // <---- function\n\nwindow.doRequest = function doRequest() {\n    fs.readFile('myBigFile', function (err, dataBuffer) {\n\n        console.log(typeof setImmediate); // <---- undefined\n\n        request({ method: 'PUT', uri: 'https://myURL.com', body: dataBuffer });  // <---- Error thrown\n    });\n}\n```\n\nThe function `doRequest` is triggered from a button in the markup.\n\nThe error that is thrown is:\n\n```\nUncaught ReferenceError: setImmediate is not defined(anonymous function) \n    @ _tls_wrap.js:340emitOne \n    @ events.js:82emit \n    @ events.js:169(anonymous function) \n    @ net.js:469\n```\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/145397346",
    "html_url": "https://github.com/electron/electron/issues/2984#issuecomment-145397346",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/2984",
    "id": 145397346,
    "user": {
      "login": "etiktin",
      "id": 4381579,
      "avatar_url": "https://avatars1.githubusercontent.com/u/4381579?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/etiktin",
      "html_url": "https://github.com/etiktin",
      "followers_url": "https://api.github.com/users/etiktin/followers",
      "following_url": "https://api.github.com/users/etiktin/following{/other_user}",
      "gists_url": "https://api.github.com/users/etiktin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/etiktin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/etiktin/subscriptions",
      "organizations_url": "https://api.github.com/users/etiktin/orgs",
      "repos_url": "https://api.github.com/users/etiktin/repos",
      "events_url": "https://api.github.com/users/etiktin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/etiktin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-04T22:58:04Z",
    "updated_at": "2015-10-04T22:58:04Z",
    "body": "See #2866.\n\nI think you might be able to fake it using something like this (just as a workaround):\n\n``` javascript\nwindow.setImmediate = global.setImmediate = setTimeout;\nwindow.clearImmediate = global.clearImmediate = clearTimeout;\n```\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/145403478",
    "html_url": "https://github.com/electron/electron/issues/2984#issuecomment-145403478",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/2984",
    "id": 145403478,
    "user": {
      "login": "antoinepairet",
      "id": 5238592,
      "avatar_url": "https://avatars0.githubusercontent.com/u/5238592?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/antoinepairet",
      "html_url": "https://github.com/antoinepairet",
      "followers_url": "https://api.github.com/users/antoinepairet/followers",
      "following_url": "https://api.github.com/users/antoinepairet/following{/other_user}",
      "gists_url": "https://api.github.com/users/antoinepairet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/antoinepairet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/antoinepairet/subscriptions",
      "organizations_url": "https://api.github.com/users/antoinepairet/orgs",
      "repos_url": "https://api.github.com/users/antoinepairet/repos",
      "events_url": "https://api.github.com/users/antoinepairet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/antoinepairet/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-04T23:57:11Z",
    "updated_at": "2015-10-04T23:57:11Z",
    "body": "@etiktin Good catch, thanks.\n\nUnfortunately, your suggestion does not work. (btw, note that it should be adapted with argument manipulation since `setTimeout` and `setImmediate` do not have the same signature:\n\n```\nvar immediateID = setImmediate(func, [param1, param2, ...]);\nvar timeoutID = window.setTimeout(func, [delay, param1, param2, ...]);\n```\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/145419711",
    "html_url": "https://github.com/electron/electron/issues/2984#issuecomment-145419711",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/2984",
    "id": 145419711,
    "user": {
      "login": "zcbenz",
      "id": 639601,
      "avatar_url": "https://avatars3.githubusercontent.com/u/639601?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zcbenz",
      "html_url": "https://github.com/zcbenz",
      "followers_url": "https://api.github.com/users/zcbenz/followers",
      "following_url": "https://api.github.com/users/zcbenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/zcbenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zcbenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zcbenz/subscriptions",
      "organizations_url": "https://api.github.com/users/zcbenz/orgs",
      "repos_url": "https://api.github.com/users/zcbenz/repos",
      "events_url": "https://api.github.com/users/zcbenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zcbenz/received_events",
      "type": "User",
      "site_admin": true
    },
    "created_at": "2015-10-05T03:22:47Z",
    "updated_at": "2015-10-05T03:22:47Z",
    "body": "By the time the preload script is executed the `setImmediate` function is still available, but once the web page started to load, the Node's globals are removed, including `setImmediate`. So you will get the undefined error when you try to use `setImmediate` after the first tick of message loop.\n\nThe solution is to bring the `setImmediate` back immediately after Electron removes the symbols:\n\n``` js\nprocess.once('loaded', function() {\n  global.setImmediate = setImmediate;\n});\n```\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/145465907",
    "html_url": "https://github.com/electron/electron/issues/2984#issuecomment-145465907",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/2984",
    "id": 145465907,
    "user": {
      "login": "antoinepairet",
      "id": 5238592,
      "avatar_url": "https://avatars0.githubusercontent.com/u/5238592?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/antoinepairet",
      "html_url": "https://github.com/antoinepairet",
      "followers_url": "https://api.github.com/users/antoinepairet/followers",
      "following_url": "https://api.github.com/users/antoinepairet/following{/other_user}",
      "gists_url": "https://api.github.com/users/antoinepairet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/antoinepairet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/antoinepairet/subscriptions",
      "organizations_url": "https://api.github.com/users/antoinepairet/orgs",
      "repos_url": "https://api.github.com/users/antoinepairet/repos",
      "events_url": "https://api.github.com/users/antoinepairet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/antoinepairet/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-05T08:49:36Z",
    "updated_at": "2015-10-05T08:49:36Z",
    "body": "@zcbenz Thanks for your explanation.\n\nTo make it work, I had to adapt your code sample to:\n\n``` js\nvar _setImmediate = setImmediate;\nprocess.once('loaded', function() {\n  global.setImmediate = _setImmediate;\n});\n```\n\nand add it at the beginning of the preload script.\nThanks a lot.\n"
  }
]