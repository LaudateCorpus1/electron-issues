[
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/182670213",
    "html_url": "https://github.com/electron/electron/issues/4441#issuecomment-182670213",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/4441",
    "id": 182670213,
    "user": {
      "login": "brenca",
      "id": 1690458,
      "avatar_url": "https://avatars1.githubusercontent.com/u/1690458?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brenca",
      "html_url": "https://github.com/brenca",
      "followers_url": "https://api.github.com/users/brenca/followers",
      "following_url": "https://api.github.com/users/brenca/following{/other_user}",
      "gists_url": "https://api.github.com/users/brenca/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brenca/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brenca/subscriptions",
      "organizations_url": "https://api.github.com/users/brenca/orgs",
      "repos_url": "https://api.github.com/users/brenca/repos",
      "events_url": "https://api.github.com/users/brenca/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brenca/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-11T01:48:06Z",
    "updated_at": "2016-02-11T01:48:06Z",
    "body": "I've tried you example with a 36.4 prebuilt and a 64bit debug build with the latest commits, and I can't reproduce the crash on Windows. Might be something osx related, which sadly I can't test for you :C \n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/182670892",
    "html_url": "https://github.com/electron/electron/issues/4441#issuecomment-182670892",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/4441",
    "id": 182670892,
    "user": {
      "login": "Mr0grog",
      "id": 74178,
      "avatar_url": "https://avatars3.githubusercontent.com/u/74178?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mr0grog",
      "html_url": "https://github.com/Mr0grog",
      "followers_url": "https://api.github.com/users/Mr0grog/followers",
      "following_url": "https://api.github.com/users/Mr0grog/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mr0grog/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mr0grog/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mr0grog/subscriptions",
      "organizations_url": "https://api.github.com/users/Mr0grog/orgs",
      "repos_url": "https://api.github.com/users/Mr0grog/repos",
      "events_url": "https://api.github.com/users/Mr0grog/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mr0grog/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-11T01:53:58Z",
    "updated_at": "2016-02-11T01:53:58Z",
    "body": "Well, that narrows down the problem a bit, I guess :\\\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/182672753",
    "html_url": "https://github.com/electron/electron/issues/4441#issuecomment-182672753",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/4441",
    "id": 182672753,
    "user": {
      "login": "brenca",
      "id": 1690458,
      "avatar_url": "https://avatars1.githubusercontent.com/u/1690458?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brenca",
      "html_url": "https://github.com/brenca",
      "followers_url": "https://api.github.com/users/brenca/followers",
      "following_url": "https://api.github.com/users/brenca/following{/other_user}",
      "gists_url": "https://api.github.com/users/brenca/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brenca/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brenca/subscriptions",
      "organizations_url": "https://api.github.com/users/brenca/orgs",
      "repos_url": "https://api.github.com/users/brenca/repos",
      "events_url": "https://api.github.com/users/brenca/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brenca/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-11T02:08:43Z",
    "updated_at": "2016-02-11T02:08:43Z",
    "body": "I might ask a friend who has a Mac tomorrow if it's not resolved by then :)\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/182958416",
    "html_url": "https://github.com/electron/electron/issues/4441#issuecomment-182958416",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/4441",
    "id": 182958416,
    "user": {
      "login": "Mr0grog",
      "id": 74178,
      "avatar_url": "https://avatars3.githubusercontent.com/u/74178?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mr0grog",
      "html_url": "https://github.com/Mr0grog",
      "followers_url": "https://api.github.com/users/Mr0grog/followers",
      "following_url": "https://api.github.com/users/Mr0grog/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mr0grog/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mr0grog/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mr0grog/subscriptions",
      "organizations_url": "https://api.github.com/users/Mr0grog/orgs",
      "repos_url": "https://api.github.com/users/Mr0grog/repos",
      "events_url": "https://api.github.com/users/Mr0grog/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mr0grog/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-11T16:59:53Z",
    "updated_at": "2016-02-11T16:59:53Z",
    "body": "@brenca thanks!\n\nI also tried building the latest Electron from master and am still seeing the crash there. It looks like the actual call to `FrameSubscriber::OnFrameDelivered` (where the crash is) comes from somewhere in Chromium code, which I don't have debugging symbols for, so it's tough to tell what's going on.\n\nAs a side note, I totally believe that this doesn't happen on Windows, since it appears that `RenderWidgetHostView` and friends are implemented in totally different ways on each platform. But just in case the problem was actually that my \"wait ~10ms before making another change approach\" wasn't the right timing on your machine, using animations struck me as a more reliable way to trigger it:\n\n``` js\nfunction crashMyWindow() {\n  mainWindow.webContents.executeJavaScript(`\n    var style = document.createElement('style');\n    style.setAttribute('type', 'text/css');\n    style.innerHTML = '@keyframes pulser { 0% { opacity: 0; } 100% { opacity: 1; } } div {animation: pulser 1s infinite;animation-direction: alternate;}';\n    document.body.appendChild(style);\n    var div = document.createElement('div');\n    div.innerHTML = 'hi';\n    document.body.appendChild(div);`);\n\n  // let the animation start going...\n  setTimeout(function() {\n\n      // subscribe to the rendered frames\n      mainWindow.webContents.beginFrameSubscription(function(buffer) {\n        // unsubscribe, setting up the crash\n        mainWindow.webContents.endFrameSubscription();\n      });\n\n  }, 100);\n}\n```\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/182962334",
    "html_url": "https://github.com/electron/electron/issues/4441#issuecomment-182962334",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/4441",
    "id": 182962334,
    "user": {
      "login": "brenca",
      "id": 1690458,
      "avatar_url": "https://avatars1.githubusercontent.com/u/1690458?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brenca",
      "html_url": "https://github.com/brenca",
      "followers_url": "https://api.github.com/users/brenca/followers",
      "following_url": "https://api.github.com/users/brenca/following{/other_user}",
      "gists_url": "https://api.github.com/users/brenca/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brenca/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brenca/subscriptions",
      "organizations_url": "https://api.github.com/users/brenca/orgs",
      "repos_url": "https://api.github.com/users/brenca/repos",
      "events_url": "https://api.github.com/users/brenca/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brenca/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-11T17:12:07Z",
    "updated_at": "2016-02-11T17:12:07Z",
    "body": "I had a similar idea yesterday, so after the original example didn't fail, I used a `setInterval` to add another \"x\" to the page, and that still didn't cause a crash. Just in case I tried the animation approach, that still didn't cause a crash on Windows. At least we really know that it's an osx problem :)\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/182975106",
    "html_url": "https://github.com/electron/electron/issues/4441#issuecomment-182975106",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/4441",
    "id": 182975106,
    "user": {
      "login": "Mr0grog",
      "id": 74178,
      "avatar_url": "https://avatars3.githubusercontent.com/u/74178?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mr0grog",
      "html_url": "https://github.com/Mr0grog",
      "followers_url": "https://api.github.com/users/Mr0grog/followers",
      "following_url": "https://api.github.com/users/Mr0grog/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mr0grog/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mr0grog/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mr0grog/subscriptions",
      "organizations_url": "https://api.github.com/users/Mr0grog/orgs",
      "repos_url": "https://api.github.com/users/Mr0grog/repos",
      "events_url": "https://api.github.com/users/Mr0grog/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mr0grog/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-11T17:46:00Z",
    "updated_at": "2016-02-11T17:46:00Z",
    "body": "Ha, I guess we were definitely on the same page!\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/183020752",
    "html_url": "https://github.com/electron/electron/issues/4441#issuecomment-183020752",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/4441",
    "id": 183020752,
    "user": {
      "login": "Mr0grog",
      "id": 74178,
      "avatar_url": "https://avatars3.githubusercontent.com/u/74178?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mr0grog",
      "html_url": "https://github.com/Mr0grog",
      "followers_url": "https://api.github.com/users/Mr0grog/followers",
      "following_url": "https://api.github.com/users/Mr0grog/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mr0grog/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mr0grog/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mr0grog/subscriptions",
      "organizations_url": "https://api.github.com/users/Mr0grog/orgs",
      "repos_url": "https://api.github.com/users/Mr0grog/repos",
      "events_url": "https://api.github.com/users/Mr0grog/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mr0grog/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-11T19:24:47Z",
    "updated_at": "2016-02-11T19:24:47Z",
    "body": "So this may be a really kludgy way to address the issue, but changing [line 37 of `atom/browser/api/frame_subscriber.cc`](https://github.com/atom/electron/blob/master/atom/browser/api/frame_subscriber.cc#L37) to check whether the frame subscriber's isolate is the current one seems to solve the issue for me:\n\n``` cpp\nvoid FrameSubscriber::OnFrameDelivered(\n    scoped_refptr<media::VideoFrame> frame, base::TimeTicks, bool result) {\n  if (!result || v8::Isolate::GetCurrent() != isolate_)\n    return;\n\n  v8::Locker locker(isolate_);\n  ...\n```\n\nIt also only hits that condition once—after returning early there, calls to `OnFrameDelivered()` stop. I also noticed that, when the crash is about to happen, the `EndFrameSubscription()` call is coming _in between_ associated calls to `FrameSubscriber::ShouldCaptureFrame()` and `FrameSubscriber::OnFrameDelivered()`. So it would seem that `EndFrameSubscription()` is effectively and safely stopping new uses of the frame subscriber, but any callbacks that have already been retrieved from the frame subscriber are still called.\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/183046669",
    "html_url": "https://github.com/electron/electron/issues/4441#issuecomment-183046669",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/4441",
    "id": 183046669,
    "user": {
      "login": "brenca",
      "id": 1690458,
      "avatar_url": "https://avatars1.githubusercontent.com/u/1690458?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brenca",
      "html_url": "https://github.com/brenca",
      "followers_url": "https://api.github.com/users/brenca/followers",
      "following_url": "https://api.github.com/users/brenca/following{/other_user}",
      "gists_url": "https://api.github.com/users/brenca/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brenca/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brenca/subscriptions",
      "organizations_url": "https://api.github.com/users/brenca/orgs",
      "repos_url": "https://api.github.com/users/brenca/repos",
      "events_url": "https://api.github.com/users/brenca/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brenca/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-11T20:17:40Z",
    "updated_at": "2016-02-11T21:24:14Z",
    "body": "Or we could always ask for the current isolate instead of using a saved one, if that works on mac (it seems to be okay on Windows), that would be a bit cleaner I guess.\n\n-- edit --\n\nOkay, that doesn't seem to work on Mac, nvm.\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/183145063",
    "html_url": "https://github.com/electron/electron/issues/4441#issuecomment-183145063",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/4441",
    "id": 183145063,
    "user": {
      "login": "brenca",
      "id": 1690458,
      "avatar_url": "https://avatars1.githubusercontent.com/u/1690458?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brenca",
      "html_url": "https://github.com/brenca",
      "followers_url": "https://api.github.com/users/brenca/followers",
      "following_url": "https://api.github.com/users/brenca/following{/other_user}",
      "gists_url": "https://api.github.com/users/brenca/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brenca/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brenca/subscriptions",
      "organizations_url": "https://api.github.com/users/brenca/orgs",
      "repos_url": "https://api.github.com/users/brenca/repos",
      "events_url": "https://api.github.com/users/brenca/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brenca/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-12T01:43:35Z",
    "updated_at": "2016-02-12T01:43:52Z",
    "body": "So the problem is that when we call `EndFrameSubscription()`, the whole `FrameSubscriber` gets deleted from the Chromium side, but the base class of the `FrameSubscriber`, `content::RenderWidgetHostViewFrameSubscriber` only declares the `ShouldCaptureFrame` method, and we are actually using another member of `FrameSubscriber` as the `DeliverFrameCallback` - but copying takes time, and the callback is called some time after `ShouldCaptureFrame` is called. If we end the subscription between a `ShouldCaptureFrame` and the callback for it - which as far as I've seen happens all the time -, Chormium tries to call the callback that is a member of an object that's already deleted, and all the members - like `isolate_` is actually just garbage. \nI cooked up a solution for this, we've tested it on both platforms and it seems to fix the issue.\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/183198914",
    "html_url": "https://github.com/electron/electron/issues/4441#issuecomment-183198914",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/4441",
    "id": 183198914,
    "user": {
      "login": "Mr0grog",
      "id": 74178,
      "avatar_url": "https://avatars3.githubusercontent.com/u/74178?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mr0grog",
      "html_url": "https://github.com/Mr0grog",
      "followers_url": "https://api.github.com/users/Mr0grog/followers",
      "following_url": "https://api.github.com/users/Mr0grog/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mr0grog/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mr0grog/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mr0grog/subscriptions",
      "organizations_url": "https://api.github.com/users/Mr0grog/orgs",
      "repos_url": "https://api.github.com/users/Mr0grog/repos",
      "events_url": "https://api.github.com/users/Mr0grog/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mr0grog/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-12T06:28:12Z",
    "updated_at": "2016-02-12T06:28:12Z",
    "body": "Thanks! I pulled down the PR and built it; fixes the issue for me! More elegant than my kludgy solution, too. (I noted one other thought over on the PR itself.)\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/184486104",
    "html_url": "https://github.com/electron/electron/issues/4441#issuecomment-184486104",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/4441",
    "id": 184486104,
    "user": {
      "login": "zcbenz",
      "id": 639601,
      "avatar_url": "https://avatars3.githubusercontent.com/u/639601?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zcbenz",
      "html_url": "https://github.com/zcbenz",
      "followers_url": "https://api.github.com/users/zcbenz/followers",
      "following_url": "https://api.github.com/users/zcbenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/zcbenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zcbenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zcbenz/subscriptions",
      "organizations_url": "https://api.github.com/users/zcbenz/orgs",
      "repos_url": "https://api.github.com/users/zcbenz/repos",
      "events_url": "https://api.github.com/users/zcbenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zcbenz/received_events",
      "type": "User",
      "site_admin": true
    },
    "created_at": "2016-02-16T02:44:57Z",
    "updated_at": "2016-02-16T02:44:57Z",
    "body": "Fixed by #4451.\n"
  }
]