[
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/163222003",
    "html_url": "https://github.com/electron/electron/issues/3699#issuecomment-163222003",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/3699",
    "id": 163222003,
    "user": {
      "login": "zcbenz",
      "id": 639601,
      "avatar_url": "https://avatars3.githubusercontent.com/u/639601?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zcbenz",
      "html_url": "https://github.com/zcbenz",
      "followers_url": "https://api.github.com/users/zcbenz/followers",
      "following_url": "https://api.github.com/users/zcbenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/zcbenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zcbenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zcbenz/subscriptions",
      "organizations_url": "https://api.github.com/users/zcbenz/orgs",
      "repos_url": "https://api.github.com/users/zcbenz/repos",
      "events_url": "https://api.github.com/users/zcbenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zcbenz/received_events",
      "type": "User",
      "site_admin": true
    },
    "created_at": "2015-12-09T12:59:35Z",
    "updated_at": "2015-12-09T12:59:35Z",
    "body": "After some debugging I think I have found the cause. In Electron the asar archive objects are destroyed when `unload` event is fired, somehow the `unload` event is fired before the page is loading and destroyed the the asar archive object that includes all built-in modules.\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/167168751",
    "html_url": "https://github.com/electron/electron/issues/3699#issuecomment-167168751",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/3699",
    "id": 167168751,
    "user": {
      "login": "justintaft",
      "id": 8340498,
      "avatar_url": "https://avatars0.githubusercontent.com/u/8340498?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/justintaft",
      "html_url": "https://github.com/justintaft",
      "followers_url": "https://api.github.com/users/justintaft/followers",
      "following_url": "https://api.github.com/users/justintaft/following{/other_user}",
      "gists_url": "https://api.github.com/users/justintaft/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/justintaft/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/justintaft/subscriptions",
      "organizations_url": "https://api.github.com/users/justintaft/orgs",
      "repos_url": "https://api.github.com/users/justintaft/repos",
      "events_url": "https://api.github.com/users/justintaft/events{/privacy}",
      "received_events_url": "https://api.github.com/users/justintaft/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-12-24T23:49:00Z",
    "updated_at": "2015-12-25T04:58:26Z",
    "body": "+1, running into same issue while writing tests for Light Table. We are using a \"file://\" url.\nhttps://github.com/LightTable/LightTable/blob/683785fdf571d32e86aa9fd7e6e98204243207b3/deploy/core/main.js#L52\n\nI did some debugging before discovering this ticket =). The atom.asar file is opened and some contents are read (verified by using dtruss on OSX). A valid File Descirptor is returned from the open syscall, however when I inspected the stored FD of the archive in the chromium dev tools, it is -1.... If i clear out the archive cache and reload the archive, I can see files within the archive using.\n"
  },
  {
    "url": "https://api.github.com/repos/electron/electron/issues/comments/168056601",
    "html_url": "https://github.com/electron/electron/issues/3699#issuecomment-168056601",
    "issue_url": "https://api.github.com/repos/electron/electron/issues/3699",
    "id": 168056601,
    "user": {
      "login": "justintaft",
      "id": 8340498,
      "avatar_url": "https://avatars0.githubusercontent.com/u/8340498?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/justintaft",
      "html_url": "https://github.com/justintaft",
      "followers_url": "https://api.github.com/users/justintaft/followers",
      "following_url": "https://api.github.com/users/justintaft/following{/other_user}",
      "gists_url": "https://api.github.com/users/justintaft/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/justintaft/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/justintaft/subscriptions",
      "organizations_url": "https://api.github.com/users/justintaft/orgs",
      "repos_url": "https://api.github.com/users/justintaft/repos",
      "events_url": "https://api.github.com/users/justintaft/events{/privacy}",
      "received_events_url": "https://api.github.com/users/justintaft/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-12-30T19:02:33Z",
    "updated_at": "2015-12-30T21:22:55Z",
    "body": "Did some debugging, the below just confirms what zcbenz has said....\n\nOn unload, an 'exit' event is fired which causes all archives to be destroyed.\nhttps://github.com/atom/electron/blob/c180607ef672db1679235800e7b78dd256408638/atom/renderer/lib/init.coffee#L87\nhttps://github.com/atom/electron/blob/a2f1390b0dadd1b43e56e5a5417795f3ecd42a8a/atom/common/lib/asar.coffee#L16\n\n`Destroy` in atom_api_asar.cc is being called, which deconstructs the archive.\nLater on when require is called ,`Stat` in atom_api_asar.cc is called. Since the  `archive_` address is now null (0x00), Stat returns false. The destroy and deconstruct call normally does not occur until later.\n\nI added some LOG statements to electron's source code to find this out.\n\nThe below is a bit cryptic, sorry...  \n\n```\n []67788:1230/103843:ERROR:atom_api_asar.cc(55)] atom_api_asar STAT archive renderer/lib/web-view/web-view.js 0x7fa088cd5150 0x7fa088ccffe0\n []67788:1230/103843:ERROR:archive.cc(203)] Statting THIS PATH, FD 0x7fa088ccffe0 renderer/lib/web-view/web-view.js , 31\n []67788:1230/103843:ERROR:atom_api_asar.cc(55)] atom_api_asar STAT archive  0x7fa088cd5150 0x7fa088ccffe0\n*[]67788:1230/103843:ERROR:archive.cc(203)] Statting THIS PATH, FD 0x7fa088ccffe0  , 31\n*[]67788:1230/103843:ERROR:atom_api_asar.cc(105)] atom_api_asar DESTROYING ARCHIVE0x7fa088cd5150 0x7fa088ccffe0\n*[]67788:1230/103843:ERROR:archive.cc(133)] Archive is deconstructing! THIS FD0x7fa088ccffe0 31\n*[]67780:1230/103844:INFO:CONSOLE(21081)] \"Got to require\", source: file:///Users/justintaft/programming/LightTable/deploy/core/node_modules/lighttable/bootstrap.js (21081)\n []67780:1230/103844:INFO:CONSOLE(21082)] \"1451500724137\", source: file:///Users/justintaft/programming/LightTable/deploy/core/node_modules/lighttable/bootstrap.js (21082)\n*[]67788:1230/103844:ERROR:atom_api_asar.cc(55)] atom_api_asar STAT archive common/api/lib 0x7fa088cd5150 0x0\n*[]67788:1230/103844:ERROR:atom_api_asar.cc(55)] atom_api_asar STAT archive renderer/api/lib 0x7fa088cd5150 0x0\n*[]67788:1230/103844:ERROR:atom_api_asar.cc(55)] atom_api_asar STAT archive renderer/api/lib/exports 0x7fa088cd5150 0x0\n []67780:1230/103844:INFO:CONSOLE(338)] \"Uncaught Error: Cannot find module 'clipboard'\", source: module.js (338)\n []67780:1230/103844:INFO:CONSOLE(36)] \"TypeError: Cannot read property 'init' of undefined\", source: file:///Users/justintaft/programming/LightTable/deploy/core/LightTable.html?id=1 (36)\n []67780:1230/103844:INFO:CONSOLE(37)] \"TypeError: Cannot read property 'init' of undefined\n     at HTMLScriptElement.script.onload (file:///Users/justintaft/programming/LightTable/deploy/core/LightTable.html?id=1:34:28)\", source: file:///Users/justintaft/programming/LightTable/deploy/core/LightTable.html?id=1 (37)\n```\n\narchive.destroy() is called here https://github.com/atom/electron/blob/a2f1390b0dadd1b43e56e5a5417795f3ecd42a8a/atom/common/lib/asar.coffee#L17\nThis was verified by creating a trace inside the event handler\n\n```\n68251:1230/113424:ERROR:archive.cc(203)] Statting THIS PATH, FD 0x7fc23962e790 renderer/lib/web-view/web-view , 31\n[68251:1230/113424:ERROR:atom_api_asar.cc(55)] atom_api_asar STAT archive renderer/lib/web-view/web-view.js 0x7fc239633850 0x7fc23962e790\n[68251:1230/113424:ERROR:archive.cc(203)] Statting THIS PATH, FD 0x7fc23962e790 renderer/lib/web-view/web-view.js , 31\n[68251:1230/113424:ERROR:atom_api_asar.cc(55)] atom_api_asar STAT archive  0x7fc239633850 0x7fc23962e790\n[68251:1230/113424:ERROR:archive.cc(203)] Statting THIS PATH, FD 0x7fc23962e790  , 31\n[68243:1230/113424:INFO:CONSOLE(32)] \"Error\n    at process.<anonymous> (ATOM_SHELL_ASAR.js:31:16)\n    at emitNone (events.js:67:13)\n    at process.emit (events.js:166:7)\n    at /Users/justintaft/programming/electron/out/D/Electron.app/Contents/Resources/atom.asar/renderer/lib/init.js:83:22\", source: ATOM_SHELL_ASAR.js (32)\n[68251:1230/113424:ERROR:atom_api_asar.cc(105)] atom_api_asar DESTROYING ARCHIVE0x7fc239633850 0x7fc23962e790\n[68251:1230/113424:ERROR:archive.cc(133)] Archive is deconstructing! THIS FD0x7fc23962e790 31\n[68243:1230/113425:INFO:CONSOLE(21081)] \"Got to require\", source: file:///Users/justintaft/programming/LightTable/deploy/core/node_modules/lighttable/bootstrap.js (21081)\n[68243:1230/113425:INFO:CONSOLE(21082)] \"1451504065241\", source: file:///Users/justintaft/programming/LightTable/deploy/core/node_modules/lighttable/bootstrap.js (21082)\n[68251:1230/113425:ERROR:atom_api_asar.cc(55)] atom_api_asar STAT archive common/api/lib 0x7fc239633850 0x0\n[68251:1230/113425:ERROR:atom_api_asar.cc(55)] atom_api_asar STAT archive renderer/api/lib 0x7fc239633850 0x0\n[68251:1230/113425:ERROR:atom_api_asar.cc(55)] atom_api_asar STAT archive renderer/api/lib/exports 0x7fc239633850 0x0\n[68243:1230/113425:INFO:CONSOLE(338)] \"Uncaught Error: Cannot find module 'clipboard'\", source: module.js (338)\n[68243:1230/113425:INFO:CONSOLE(36)] \"TypeError: Cannot read property 'init' of undefined\", source: file:///Users/justintaft/programming/LightTable/deploy/core/LightTable.html?id=1 (36)\n[68243:1230/113425:INFO:CONSOLE(37)] \"TypeError: Cannot read property 'init' of undefined\n    at HTMLScriptElement.script.onload (file:///Users/justintaft/programming/LightTable/deploy/core/LightTable.html?id=1:34:28)\", source: file:///Users/justintaft/programming/LightTable/deploy/core/LightTable.html?id=1 (37)\nKilling chrome\n```\n"
  }
]